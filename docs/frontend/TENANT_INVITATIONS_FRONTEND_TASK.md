# مهمة تطوير واجهة المستخدم - نظام دعوات المستأجرين

## نظرة عامة

هذه المهمة تتعلق بتطوير واجهة المستخدم (Frontend) لنظام دعوات المستأجرين (Tenant Invitations) باستخدام React. المطور لديه الحرية الكاملة في اختيار الأدوات والمكتبات وتصميم الواجهة.

---

## المتطلبات الوظيفية

### 1. صفحة إدارة الدعوات (للمالك)

#### 1.1 قائمة الدعوات
- عرض جميع الدعوات الخاصة بالملكية الحالية
- فلترة حسب الحالة: `pending`, `accepted`, `expired`, `cancelled`
- بحث بالبريد الإلكتروني أو الاسم أو الرمز
- ترقيم الصفحات (Pagination)
- عرض معلومات الدعوة:
  - البريد الإلكتروني / رقم الهاتف
  - الاسم (إن وجد)
  - الحالة
  - تاريخ الانتهاء
  - تاريخ الإنشاء
  - من أنشأ الدعوة
  - عدد المستأجرين (للدعوات متعددة الاستخدام)

#### 1.2 إنشاء دعوة واحدة
- نموذج لإنشاء دعوة واحدة
- الحقول:
  - البريد الإلكتروني (اختياري - مطلوب إذا لم يتم إدخال رقم الهاتف)
  - رقم الهاتف (اختياري - مطلوب إذا لم يتم إدخال البريد الإلكتروني)
  - الاسم (اختياري)
  - عدد أيام الانتهاء (افتراضي: 7 أيام، من 1 إلى 30)
  - ملاحظات (اختياري)
- التحقق من صحة البيانات
- إرسال الدعوة وإظهار رسالة نجاح
- عرض رابط الدعوة (للدعوات بدون بريد/هاتف)

#### 1.3 إنشاء دعوات متعددة (Bulk)
- نموذج لإنشاء عدة دعوات دفعة واحدة
- إضافة/حذف صفوف للدعوات
- لكل دعوة: بريد إلكتروني، اسم (اختياري)
- إعدادات مشتركة: عدد أيام الانتهاء، ملاحظات
- معالجة الأخطاء لكل دعوة على حدة
- عرض النتائج (نجح/فشل لكل دعوة)

#### 1.4 إنشاء رابط دعوة (بدون بريد/هاتف)
- نموذج بسيط لإنشاء رابط دعوة عام
- الحقول: الاسم (اختياري)، عدد أيام الانتهاء، ملاحظات
- عرض الرابط بعد الإنشاء
- إمكانية نسخ الرابط
- إمكانية مشاركة الرابط (QR Code - اختياري)

#### 1.5 عرض تفاصيل الدعوة
- صفحة/مودال لعرض تفاصيل الدعوة
- معلومات الدعوة الكاملة
- للمستخدم الواحد: معلومات المستأجر الذي قبل الدعوة
- للمتعددة الاستخدام: قائمة بجميع المستأجرين الذين انضموا
- إحصائيات: عدد المستأجرين، تاريخ آخر قبول، إلخ

#### 1.6 إعادة إرسال الدعوة
- زر لإعادة إرسال البريد الإلكتروني
- متاح فقط للدعوات التي لديها بريد إلكتروني
- تأكيد قبل الإرسال

#### 1.7 إلغاء الدعوة
- زر لإلغاء الدعوة
- تأكيد قبل الإلغاء
- متاح للدعوات المعلقة فقط

#### 1.8 إغلاق الدعوة متعددة الاستخدام
- زر خاص لإغلاق الدعوات بدون بريد/هاتف
- تأكيد قبل الإغلاق
- متاح فقط للدعوات متعددة الاستخدام

---

### 2. صفحة التسجيل (للمستأجر)

#### 2.1 صفحة التحقق من الرمز
- صفحة عامة: `/register/tenant?token={token}`
- التحقق من صحة الرمز عند تحميل الصفحة
- عرض معلومات الدعوة:
  - اسم الملكية
  - البريد الإلكتروني (إن وجد)
  - الاسم (إن وجد)
  - تاريخ الانتهاء
- معالجة الأخطاء:
  - رمز غير صالح
  - دعوة منتهية الصلاحية
  - دعوة ملغاة
  - دعوة مقبولة مسبقاً (للدعوات أحادية الاستخدام)

#### 2.2 نموذج التسجيل
- نموذج شامل لتسجيل المستأجر
- الأقسام:
  
  **المعلومات الشخصية:**
  - الاسم الأول (مطلوب)
  - اسم العائلة (مطلوب)
  - البريد الإلكتروني (مطلوب، يتم ملؤه تلقائياً إن كان في الدعوة)
  - رقم الهاتف (اختياري)
  
  **أمان الحساب:**
  - كلمة المرور (مطلوب، حد أدنى 8 أحرف)
  - تأكيد كلمة المرور (مطلوب)
  
  **معلومات الهوية:**
  - رقم الهوية الوطنية (اختياري)
  - نوع الهوية: `national_id`, `iqama`, `passport`, `commercial_registration`
  - تاريخ انتهاء الهوية (اختياري)
  
  **جهة الاتصال للطوارئ:**
  - الاسم (اختياري)
  - رقم الهاتف (اختياري)
  - الصلة (اختياري)
  
  **معلومات التوظيف:**
  - حالة التوظيف: `employed`, `self_employed`, `unemployed`, `retired`, `student`
  - جهة العمل (اختياري)
  - الدخل الشهري (اختياري)
  
  **إضافي:**
  - ملاحظات (اختياري)

#### 2.3 معالجة التسجيل
- التحقق من صحة جميع الحقول
- التحقق من تطابق البريد الإلكتروني (للدعوات أحادية الاستخدام)
- إرسال طلب التسجيل
- معالجة الأخطاء:
  - أخطاء التحقق
  - البريد الإلكتروني لا يطابق الدعوة
  - المستأجر موجود مسبقاً
  - أخطاء أخرى

#### 2.4 بعد التسجيل الناجح
- حفظ رمز الوصول (Access Token)
- إعادة التوجيه إلى لوحة التحكم
- إظهار رسالة ترحيب
- تسجيل دخول تلقائي

---

### 3. الإشعارات (Notifications)

#### 3.1 عرض الإشعارات
- عرض الإشعارات المتعلقة بالدعوات في الوقت الفعلي
- تصنيف الإشعارات حسب النوع:
  - `info` - عند إنشاء دعوة جديدة
  - `success` - عند قبول دعوة أو انضمام مستأجر
- عرض عدد الإشعارات غير المقروءة

#### 3.2 معالجة الإشعارات
- تحديث الإشعارات في الوقت الفعلي (Laravel Broadcasting)
- عند النقر على الإشعار:
  - الانتقال إلى صفحة الدعوة أو المستأجر
  - تمييز الإشعار كمقروء

---

## المتطلبات التقنية

### 1. التكنولوجيا (اختياري - للمطور)

**ملاحظة:** المطور حر في اختيار أي أدوات يفضلها.

---

### 2. API Integration

#### 2.1 Endpoints المطلوبة

**للمالك (مطلوب مصادقة):**
- `GET /api/v1/tenants/invitations` - قائمة الدعوات
- `POST /api/v1/tenants/invitations` - إنشاء دعوة واحدة
- `POST /api/v1/tenants/invitations/bulk` - إنشاء دعوات متعددة
- `POST /api/v1/tenants/invitations/generate-link` - إنشاء رابط دعوة
- `GET /api/v1/tenants/invitations/{uuid}` - عرض تفاصيل الدعوة
- `POST /api/v1/tenants/invitations/{uuid}/resend` - إعادة إرسال
- `POST /api/v1/tenants/invitations/{uuid}/cancel` - إلغاء الدعوة

**عام (بدون مصادقة):**
- `GET /api/v1/public/tenant-invitations/{token}/validate` - التحقق من الرمز
- `POST /api/v1/public/tenant-invitations/{token}/accept` - قبول الدعوة والتسجيل

**الإشعارات:**
- `GET /api/v1/notifications` - قائمة الإشعارات
- `POST /api/v1/notifications/{id}/read` - تمييز كمقروء
- Real-time: الاستماع إلى قناة `private-user.{user_id}`

#### 2.2 Authentication
- استخدام Bearer Token في Header
- حفظ Token في localStorage أو secure storage
- إدارة Refresh Token
- معالجة انتهاء صلاحية Token

#### 2.3 Ownership Scope
- استخدام Cookie `ownership_uuid` للتعامل مع الملكية
- إدارة تبديل الملكيات (إن وجد)

---

### 3. Real-time Notifications

#### 3.1 إعداد Laravel Echo
```javascript
// مثال
import Echo from 'laravel-echo';
import Pusher from 'pusher-js';

window.Pusher = Pusher;

window.Echo = new Echo({
    broadcaster: 'reverb',
    key: process.env.REACT_APP_REVERB_APP_KEY,
    wsHost: process.env.REACT_APP_REVERB_HOST,
    wsPort: process.env.REACT_APP_REVERB_PORT,
    wssPort: process.env.REACT_APP_REVERB_PORT,
    forceTLS: false,
    enabledTransports: ['ws', 'wss'],
});
```

#### 3.2 الاستماع للإشعارات
```javascript
// الاستماع لإشعارات المستخدم
Echo.private(`user.${userId}`)
    .notification((notification) => {
        // معالجة الإشعار الجديد
        if (notification.category === 'tenant_invitation') {
            // تحديث قائمة الإشعارات
            // إظهار إشعار في الواجهة
        }
    });
```

---

## حالات الاستخدام (Use Cases)

### Use Case 1: المالك يريد دعوة مستأجر محدد

**السيناريو:**
1. المالك يذهب إلى صفحة الدعوات
2. ينقر على "إنشاء دعوة جديدة"
3. يدخل البريد الإلكتروني والاسم
4. يضغط "إرسال"
5. يتم إرسال البريد الإلكتروني تلقائياً
6. تظهر الدعوة في القائمة بحالة `pending`
7. المالك يتلقى إشعاراً عند قبول الدعوة

**الحالات الاستثنائية:**
- البريد الإلكتروني غير صالح
- الدعوة منتهية الصلاحية
- المستأجر موجود مسبقاً

---

### Use Case 2: المالك يريد دعوة عدة مستأجرين

**السيناريو:**
1. المالك يذهب إلى "دعوات متعددة"
2. يضيف عدة صفوف (حتى 100)
3. يدخل البريد الإلكتروني لكل مستأجر
4. يضغط "إرسال الكل"
5. يتم إرسال جميع الدعوات
6. تظهر النتائج (نجح/فشل لكل دعوة)

---

### Use Case 3: المالك يريد رابط دعوة عام

**السيناريو:**
1. المالك ينقر على "إنشاء رابط دعوة"
2. يترك البريد الإلكتروني والهاتف فارغين
3. يضبط عدد أيام الانتهاء (مثلاً 30 يوم)
4. يضغط "إنشاء"
5. يحصل على رابط دعوة
6. يشارك الرابط على الموقع أو وسائل التواصل
7. أي مستأجر يمكنه استخدام الرابط للتسجيل
8. المالك يتلقى إشعاراً عند كل انضمام جديد

---

### Use Case 4: المستأجر يستقبل دعوة

**السيناريو:**
1. المستأجر يستقبل بريد إلكتروني بالدعوة
2. ينقر على رابط التسجيل
3. يتم توجيهه إلى صفحة التسجيل
4. يتم التحقق من الرمز تلقائياً
5. يظهر نموذج التسجيل مع ملء البريد الإلكتروني تلقائياً
6. المستأجر يملأ باقي البيانات
7. يضغط "تسجيل"
8. يتم إنشاء الحساب والمستأجر
9. يتم تسجيل الدخول تلقائياً
10. يتم التوجيه إلى لوحة التحكم

**الحالات الاستثنائية:**
- الرمز غير صالح
- الدعوة منتهية الصلاحية
- الدعوة مقبولة مسبقاً (للدعوات أحادية الاستخدام)
- البريد الإلكتروني لا يطابق الدعوة
- المستأجر موجود مسبقاً

---

### Use Case 5: المستأجر يستخدم رابط عام

**السيناريو:**
1. المستأجر يجد رابط دعوة على الموقع
2. ينقر على الرابط
3. يتم التحقق من الرمز
4. يظهر نموذج التسجيل (بدون ملء البريد الإلكتروني)
5. يملأ جميع البيانات بما فيها البريد الإلكتروني
6. يسجل بنجاح
7. يمكن لمستأجرين آخرين استخدام نفس الرابط

---

## متطلبات التصميم

### 1. Responsive Design
- يجب أن تعمل الواجهة على:
  - Desktop (1920px+)
  - Laptop (1366px - 1920px)
  - Tablet (768px - 1366px)
  - Mobile (320px - 768px)

### 2. Accessibility
- دعم لوحة المفاتيح
- ARIA labels
- Contrast ratios مناسبة
- دعم قارئ الشاشة

### 3. UX Considerations
- Loading states لكل عملية
- Error handling واضح
- Success messages
- Confirmation dialogs للعمليات الحساسة
- Toast notifications للإشعارات
- Skeleton loaders أثناء التحميل

### 4. RTL Support
- دعم العربية والإنجليزية
- تبديل الاتجاه تلقائياً حسب اللغة
- تصميم متجاوب للاتجاهين

---

## حالات الاختبار المطلوبة

### 1. اختبارات الوظائف الأساسية
- ✅ إنشاء دعوة واحدة بنجاح
- ✅ إنشاء دعوات متعددة بنجاح
- ✅ إنشاء رابط دعوة عام
- ✅ عرض قائمة الدعوات مع الفلترة
- ✅ عرض تفاصيل الدعوة
- ✅ إعادة إرسال الدعوة
- ✅ إلغاء الدعوة
- ✅ قبول دعوة والتسجيل بنجاح

### 2. اختبارات التحقق من الصحة
- ✅ التحقق من البريد الإلكتروني
- ✅ التحقق من رقم الهاتف (صيغة سعودية)
- ✅ التحقق من كلمة المرور (حد أدنى 8 أحرف)
- ✅ التحقق من تطابق كلمة المرور
- ✅ التحقق من الحقول المطلوبة

### 3. اختبارات الأخطاء
- ✅ معالجة رمز غير صالح
- ✅ معالجة دعوة منتهية الصلاحية
- ✅ معالجة دعوة ملغاة
- ✅ معالجة دعوة مقبولة مسبقاً
- ✅ معالجة البريد الإلكتروني لا يطابق الدعوة
- ✅ معالجة المستأجر موجود مسبقاً
- ✅ معالجة أخطاء الشبكة
- ✅ معالجة انتهاء صلاحية Token

### 4. اختبارات Real-time
- ✅ استقبال إشعار عند إنشاء دعوة
- ✅ استقبال إشعار عند قبول دعوة
- ✅ استقبال إشعار عند انضمام مستأجر جديد

---

## Checklist للتسليم

- [ ] جميع الصفحات المطلوبة مكتملة
- [ ] جميع الـ API endpoints متكاملة
<!-- - [ ] Real-time notifications تعمل -->
- [ ] Responsive design على جميع الأجهزة
- [ ] RTL support للعربية
- [ ] Error handling شامل
- [ ] Loading states لجميع العمليات
- [ ] Validation على جميع النماذج
- [ ] Testing للحالات الرئيسية
- [ ] Documentation كامل
- [ ] Code review ready
- [ ] Performance optimized
- [ ] Security best practices

---

**تاريخ الإنشاء:** 15 ديسمبر 2025  
**الحالة:** ✅ جاهز للبدء  
**الأولوية:** عالية

