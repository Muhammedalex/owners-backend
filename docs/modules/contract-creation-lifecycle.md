# Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø¯ - Contract Creation Lifecycle

## ğŸ“‹ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠØ´Ø±Ø­ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯ØŒ Ø¨Ø¯Ø¡Ø§Ù‹ Ù…Ù† Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù€ Request ÙˆØ­ØªÙ‰ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù€ ResponseØŒ Ù…Ø¹ ØªÙˆØ¶ÙŠØ­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø© ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.

---

## ğŸ”„ Ù…Ø®Ø·Ø· ØªØ¯ÙÙ‚ Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù‚Ø¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   1. REQUEST RECEIVED                            â”‚
â”‚              POST /api/v1/contracts                             â”‚
â”‚                                                                  â”‚
â”‚  Headers:                                                        â”‚
â”‚  - Authorization: Bearer {token}                                â”‚
â”‚  - Cookie: ownership_uuid={uuid}                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   2. MIDDLEWARE PROCESSING                      â”‚
â”‚                                                                  â”‚
â”‚  âœ“ auth:sanctum          â†’ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆØ«ÙŠÙ‚                   â”‚
â”‚  âœ“ ownership.scope       â†’ ØªØ­Ø¯ÙŠØ¯ ownership_id                  â”‚
â”‚  âœ“ permissions            â†’ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   3. REQUEST VALIDATION                         â”‚
â”‚              StoreContractRequest::rules()                      â”‚
â”‚                                                                  â”‚
â”‚  âœ“ Required Fields:                                             â”‚
â”‚    - units[] (array, min:1)                                     â”‚
â”‚    - units[].unit_id (required, exists)                         â”‚
â”‚    - tenant_id (required, exists)                               â”‚
â”‚    - number (required, unique)                                  â”‚
â”‚    - start (required, date)                                     â”‚
â”‚    - end (required, date, after:start)                          â”‚
â”‚                                                                  â”‚
â”‚  âœ“ Optional Fields:                                             â”‚
â”‚    - base_rent, rent_fees, vat_amount, total_rent               â”‚
â”‚    - previous_balance                                           â”‚
â”‚    - payment_frequency                                          â”‚
â”‚    - deposit, deposit_status                                    â”‚
â”‚    - ejar_code                                                  â”‚
â”‚    - status                                                     â”‚
â”‚    - ejar_pdf (file)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   4. CUSTOM VALIDATION                          â”‚
â”‚         StoreContractRequest::withValidator()                   â”‚
â”‚                                                                  â”‚
â”‚  âœ“ require_ejar_code          â†’ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù„Ø²Ø§Ù…ÙŠØ© ÙƒÙˆØ¯ Ø¥ÙŠØ¬Ø§Ø±    â”‚
â”‚  âœ“ allow_backdated_contracts  â†’ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù…Ø¤Ø±Ø®Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹ â”‚
â”‚  âœ“ min/max_contract_duration  â†’ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¯Ø© Ø§Ù„Ø¹Ù‚Ø¯            â”‚
â”‚  âœ“ max_units_per_contract     â†’ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   5. CONTRACT SERVICE                           â”‚
â”‚              ContractService::create()                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5.1 Apply Default Settings                                â”‚  â”‚
â”‚  â”‚    applyDefaultSettings()                                 â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  âœ“ default_contract_status      â†’ 'draft'                â”‚  â”‚
â”‚  â”‚  âœ“ default_payment_frequency    â†’ 'monthly'              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5.2 Validate Units                                       â”‚  â”‚
â”‚  â”‚    validateUnitsForContract()                            â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  âœ“ Check max_units_per_contract                          â”‚  â”‚
â”‚  â”‚  âœ“ Validate units belong to ownership                    â”‚  â”‚
â”‚  â”‚  âœ“ Check for conflicting active contracts                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5.3 Apply Financial Calculations                         â”‚  â”‚
â”‚  â”‚    applyFinancialCalculations()                          â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  IF auto_calculate_contract_rent = true:                 â”‚  â”‚
â”‚  â”‚    âœ“ Calculate base_rent from units sum                  â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  IF auto_calculate_total_rent = true:                    â”‚  â”‚
â”‚  â”‚    âœ“ Calculate vat_amount from contract_vat_percentage   â”‚  â”‚
â”‚  â”‚    âœ“ Calculate total_rent = base + fees + vat           â”‚  â”‚
â”‚  â”‚    IF auto_calculate_previous_balance_to_total_rent:     â”‚  â”‚
â”‚  â”‚      âœ“ Add previous_balance to total_rent                â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5.4 Create Contract Record                               â”‚  â”‚
â”‚  â”‚    ContractRepository::create()                          â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  âœ“ Insert into contracts table                           â”‚  â”‚
  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5.5 Sync Units Pivot                                      â”‚  â”‚
â”‚  â”‚    contract->units()->sync()                             â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  âœ“ Attach units with rent_amount & notes                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5.6 Update Units Status                                  â”‚  â”‚
â”‚  â”‚    updateUnitsStatusForContract()                        â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  IF status = 'active':                                   â”‚  â”‚
â”‚  â”‚    âœ“ Change units status to 'rented'                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   6. UPLOAD EJAR PDF                            â”‚
â”‚              ContractController::store()                       â”‚
â”‚                                                                  â”‚
â”‚  IF ejar_pdf file provided:                                     â”‚
â”‚    âœ“ Delete old ejar_pdf if exists                             â”‚
â”‚    âœ“ Upload new PDF via DocumentService                        â”‚
â”‚    âœ“ Link to contract with type 'ejar_pdf'                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   7. LOAD RELATIONSHIPS                         â”‚
â”‚                                                                  â”‚
â”‚  âœ“ units                                                        â”‚
â”‚  âœ“ tenant.user                                                  â”‚
â”‚  âœ“ ownership                                                    â”‚
â”‚  âœ“ createdBy                                                    â”‚
â”‚  âœ“ approvedBy                                                   â”‚
â”‚  âœ“ parent, children                                            â”‚
â”‚  âœ“ terms                                                        â”‚
â”‚  âœ“ documents                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   8. SEND NOTIFICATIONS                         â”‚
â”‚              notifyContractCreated()                            â”‚
â”‚                                                                  â”‚
â”‚  âœ“ System notification                                          â”‚
â”‚  âœ“ Email to tenant (if enabled)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   9. RETURN RESPONSE                            â”‚
â”‚                                                                  â”‚
â”‚  Status: 201 Created                                            â”‚
â”‚  Body:                                                          â”‚
â”‚  {                                                              â”‚
â”‚    "success": true,                                             â”‚
â”‚    "message": "Contract created successfully",                  â”‚
â”‚    "data": ContractResource                                     â”‚
â”‚  }                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¥ ØªØ­Ù„ÙŠÙ„ Request Ø§Ù„Ù…Ø±Ø³Ù„

### Ù…Ø«Ø§Ù„ Request ÙƒØ§Ù…Ù„:

```json
{
  "units": [
    {
      "unit_id": 1,
      "rent_amount": 5000,
      "notes": "Unit A - Ground floor"
    },
    {
      "unit_id": 2,
      "rent_amount": 3000,
      "notes": "Unit B - First floor"
    }
  ],
  "tenant_id": 5,
  "number": "CNT-2025-001",
  "start": "2025-02-01",
  "end": "2026-01-31",
  "base_rent": 8000,
  "rent_fees": 500,
  "vat_amount": 1275,
  "total_rent": 9775,
  "previous_balance": 2000,
  "payment_frequency": "monthly",
  "deposit": 16000,
  "deposit_status": "pending",
  "ejar_code": "EJ-123456",
  "status": "draft",
  "ejar_pdf": "[FILE]"
}
```

---

## ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ - Ù…Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡/ØªØ­Ø³ÙŠÙ†Ù‡

### âœ… Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Required) - Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡Ø§:

| Ø§Ù„Ø­Ù‚Ù„ | Ø§Ù„Ø³Ø¨Ø¨ | Ù…Ù„Ø§Ø­Ø¸Ø§Øª |
|------|-------|---------|
| `units[]` | Ù…ØµØ¯Ø± Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ÙˆØ­ÙŠØ¯ | âœ… Ù…Ø·Ù„ÙˆØ¨ - Single source of truth |
| `units[].unit_id` | ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ­Ø¯Ø© | âœ… Ù…Ø·Ù„ÙˆØ¨ |
| `tenant_id` | Ø±Ø¨Ø· Ø§Ù„Ø¹Ù‚Ø¯ Ø¨Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± | âœ… Ù…Ø·Ù„ÙˆØ¨ |
| `number` | Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„ÙØ±ÙŠØ¯ | âœ… Ù…Ø·Ù„ÙˆØ¨ |
| `start` | ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ù‚Ø¯ | âœ… Ù…Ø·Ù„ÙˆØ¨ |
| `end` | ØªØ§Ø±ÙŠØ® Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ù‚Ø¯ | âœ… Ù…Ø·Ù„ÙˆØ¨ |

---

### âš ï¸ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ø­Ø³Ø§Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Optional - Auto-calculated):

| Ø§Ù„Ø­Ù‚Ù„ | Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ | Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ | ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡ØŸ |
|------|-----------------|----------------|--------------|
| `base_rent` | âœ… Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹ `units[].rent_amount` | `auto_calculate_contract_rent` | âœ… **Ù†Ø¹Ù…** - Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„ |
| `vat_amount` | âœ… Ù…Ù† `base_rent + rent_fees` Ã— `contract_vat_percentage` | `auto_calculate_total_rent` | âœ… **Ù†Ø¹Ù…** - Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„ |
| `total_rent` | âœ… Ù…Ù† `base_rent + rent_fees + vat_amount` (+ `previous_balance` Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„) | `auto_calculate_total_rent` + `auto_calculate_previous_balance_to_total_rent` | âœ… **Ù†Ø¹Ù…** - Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„ |
| `status` | âœ… Ù…Ù† `default_contract_status` | `default_contract_status` | âœ… **Ù†Ø¹Ù…** - Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ |
| `payment_frequency` | âœ… Ù…Ù† `default_payment_frequency` | `default_payment_frequency` | âœ… **Ù†Ø¹Ù…** - Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡ |

---

### ğŸ“Š Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (Optional - Manual Input):

| Ø§Ù„Ø­Ù‚Ù„ | Ø§Ù„ÙˆØµÙ | ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡ØŸ |
|------|-------|--------------|
| `rent_fees` | Ø±Ø³ÙˆÙ… Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± | âŒ **Ù„Ø§** - Ù‚Ø¯ ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø¯ |
| `previous_balance` | Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚ | âŒ **Ù„Ø§** - Ø®Ø§Øµ Ø¨ÙƒÙ„ Ø¹Ù‚Ø¯ |
| `deposit` | Ù…Ø¨Ù„Øº Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ | âŒ **Ù„Ø§** - Ù‚Ø¯ ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø¯ |
| `deposit_status` | Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ | âœ… **Ù†Ø¹Ù…** - ÙŠÙ…ÙƒÙ† ØªØ¹ÙŠÙŠÙ†Ù‡ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ø¥Ù„Ù‰ 'pending' |
| `ejar_code` | ÙƒÙˆØ¯ Ø¥ÙŠØ¬Ø§Ø± | âš ï¸ **ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯** - Ø¥Ø°Ø§ ÙƒØ§Ù† `require_ejar_code = true` ÙŠØµØ¨Ø­ Ù…Ø·Ù„ÙˆØ¨Ø§Ù‹ |
| `ejar_pdf` | Ù…Ù„Ù PDF Ù…Ù† Ø¥ÙŠØ¬Ø§Ø± | âŒ **Ù„Ø§** - Ø§Ø®ØªÙŠØ§Ø±ÙŠ |
| `units[].rent_amount` | Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„ÙˆØ­Ø¯Ø© | âš ï¸ **ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯** - Ø¥Ø°Ø§ ÙƒØ§Ù† `auto_calculate_contract_rent = false` Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù…Ø·Ù„ÙˆØ¨Ø§Ù‹ |
| `units[].notes` | Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© | âŒ **Ù„Ø§** - Ø§Ø®ØªÙŠØ§Ø±ÙŠ |

---

## ğŸ¯ Request Ù…Ø­Ø³Ù‘Ù† (Minimal Request)

### Ù…Ø¹ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù…ÙØ¹Ù‘Ù„Ø©:
- `auto_calculate_contract_rent = true`
- `auto_calculate_total_rent = true`
- `auto_calculate_previous_balance_to_total_rent = false`
- `default_contract_status = 'draft'`
- `default_payment_frequency = 'monthly'`
- `require_ejar_code = false`

### Request Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:

```json
{
  "units": [
    {
      "unit_id": 1,
      "rent_amount": 5000,
      "notes": "Unit A"
    },
    {
      "unit_id": 2,
      "rent_amount": 3000
    }
  ],
  "tenant_id": 5,
  "number": "CNT-2025-001",
  "start": "2025-02-01",
  "end": "2026-01-31"
}
```

### Ù…Ø§ Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:

```json
{
  "base_rent": 8000,              // âœ… Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹ units[].rent_amount
  "vat_amount": 1275,             // âœ… Ù…Ù† (8000 + 0) Ã— 15%
  "total_rent": 9275,             // âœ… Ù…Ù† 8000 + 0 + 1275
  "status": "draft",               // âœ… Ù…Ù† default_contract_status
  "payment_frequency": "monthly"  // âœ… Ù…Ù† default_payment_frequency
}
```

---

## ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨

### 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ù‚Ù‚ (Validation Settings)

| Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ | Ø§Ù„Ù…ÙˆÙ‚Ø¹ | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|---------|--------|---------|
| `require_ejar_code` | `StoreContractRequest::withValidator()` | Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ù„Ø²Ø§Ù…ÙŠØ© ÙƒÙˆØ¯ Ø¥ÙŠØ¬Ø§Ø± |
| `allow_backdated_contracts` | `StoreContractRequest::withValidator()` | Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù…Ø¤Ø±Ø®Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹ |
| `min_contract_duration_months` | `StoreContractRequest::withValidator()` | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù…Ø¯Ø© Ø§Ù„Ø¹Ù‚Ø¯ |
| `max_contract_duration_months` | `StoreContractRequest::withValidator()` | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù…Ø¯Ø© Ø§Ù„Ø¹Ù‚Ø¯ |
| `max_units_per_contract` | `StoreContractRequest::withValidator()` + `ContractService::create()` | Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª |

---

### 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Default Values)

| Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ | Ø§Ù„Ù…ÙˆÙ‚Ø¹ | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|---------|--------|---------|
| `default_contract_status` | `ContractService::applyDefaultSettings()` | Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø¹Ù‚Ø¯ |
| `default_payment_frequency` | `ContractService::applyDefaultSettings()` | ØªØ±Ø¯Ø¯ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ |

---

### 3. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© (Financial Calculations)

| Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ | Ø§Ù„Ù…ÙˆÙ‚Ø¹ | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|---------|--------|---------|
| `auto_calculate_contract_rent` | `ContractService::applyFinancialCalculations()` | Ø­Ø³Ø§Ø¨ base_rent Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹ Ø¥ÙŠØ¬Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª |
| `auto_calculate_total_rent` | `ContractService::applyFinancialCalculations()` | Ø­Ø³Ø§Ø¨ vat_amount Ùˆ total_rent ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ |
| `contract_vat_percentage` | `ContractSettingService::calculateVatAmount()` | Ù†Ø³Ø¨Ø© VAT Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨ |
| `auto_calculate_previous_balance_to_total_rent` | `ContractSettingService::calculateTotalRent()` | Ø¥Ø¶Ø§ÙØ© previous_balance Ø¥Ù„Ù‰ total_rent |

---

## ğŸ”„ Ù…Ø«Ø§Ù„ ÙƒØ§Ù…Ù„ - Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Request

### Request Ø§Ù„Ù…Ø±Ø³Ù„:

```json
POST /api/v1/contracts
Content-Type: multipart/form-data

{
  "units": [
    {"unit_id": 1, "rent_amount": 5000},
    {"unit_id": 2, "rent_amount": 3000}
  ],
  "tenant_id": 5,
  "number": "CNT-2025-001",
  "start": "2025-02-01",
  "end": "2026-01-31",
  "rent_fees": 500,
  "previous_balance": 2000
}
```

---

### Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©:

#### Step 1: Request Validation âœ…
```php
// StoreContractRequest::rules()
âœ“ units[] exists and has min 1 item
âœ“ units[].unit_id exists in database
âœ“ tenant_id exists
âœ“ number is unique
âœ“ start is valid date
âœ“ end is after start
```

#### Step 2: Custom Validation âœ…
```php
// StoreContractRequest::withValidator()
âœ“ require_ejar_code = false â†’ ejar_code not required
âœ“ allow_backdated_contracts = true â†’ start date can be in past
âœ“ Duration = 12 months â†’ within min(1) and max(120)
âœ“ Units count = 2 â†’ within max(10)
```

#### Step 3: Apply Default Settings âœ…
```php
// ContractService::applyDefaultSettings()
âœ“ status = 'draft' (from default_contract_status)
âœ“ payment_frequency = 'monthly' (from default_payment_frequency)
```

#### Step 4: Validate Units âœ…
```php
// ContractService::validateUnitsForContract()
âœ“ Units belong to ownership
âœ“ No conflicting active contracts
```

#### Step 5: Financial Calculations âœ…
```php
// ContractService::applyFinancialCalculations()

// auto_calculate_contract_rent = true
base_rent = 5000 + 3000 = 8000 âœ…

// auto_calculate_total_rent = true
vat_amount = (8000 + 500) Ã— 15% = 1275 âœ…
total_rent = 8000 + 500 + 1275 = 9775 âœ…

// auto_calculate_previous_balance_to_total_rent = false
// previous_balance NOT added to total_rent âœ…
```

#### Step 6: Create Contract âœ…
```php
// ContractRepository::create()
INSERT INTO contracts (
  tenant_id = 5,
  ownership_id = 1,
  number = 'CNT-2025-001',
  start = '2025-02-01',
  end = '2026-01-31',
  base_rent = 8000,
  rent_fees = 500,
  vat_amount = 1275,
  total_rent = 9775,
  previous_balance = 2000,
  payment_frequency = 'monthly',
  status = 'draft'
)
```

#### Step 7: Sync Units âœ…
```php
// contract->units()->sync()
INSERT INTO contract_units (
  contract_id = 1, unit_id = 1, rent_amount = 5000, notes = NULL
)
INSERT INTO contract_units (
  contract_id = 1, unit_id = 2, rent_amount = 3000, notes = NULL
)
```

#### Step 8: Update Units Status âœ…
```php
// status = 'draft' â†’ No status change
// Units remain 'available'
```

---

## ğŸ’¡ ØªÙˆØµÙŠØ§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ†

### 1. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Request

**Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ø¥Ø²Ø§Ù„ØªÙ‡Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ÙØ¹Ù‘Ù„Ø©:**

```json
// âŒ Ù„Ø§ ØªØ±Ø³Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ÙØ¹Ù‘Ù„Ø©:
{
  "base_rent": 8000,         // âœ… Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† units
  "vat_amount": 1275,        // âœ… Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  "total_rent": 9775,       // âœ… Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  "status": "draft",         // âœ… Ù…Ù† default_contract_status
  "payment_frequency": "monthly" // âœ… Ù…Ù† default_payment_frequency
}
```

### 2. Request Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨

```json
{
  "units": [
    {"unit_id": 1, "rent_amount": 5000},
    {"unit_id": 2, "rent_amount": 3000}
  ],
  "tenant_id": 5,
  "number": "CNT-2025-001",
  "start": "2025-02-01",
  "end": "2026-01-31",
  
  // Optional fields (only if needed):
  "rent_fees": 500,           // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø®ØªÙ„Ù Ø¹Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  "previous_balance": 2000,  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø±ØµÙŠØ¯ Ø³Ø§Ø¨Ù‚
  "deposit": 16000,          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø®ØªÙ„Ù Ø¹Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©
  "ejar_code": "EJ-123456",  // Ø¥Ø°Ø§ ÙƒØ§Ù† require_ejar_code = true
  "ejar_pdf": "[FILE]"       // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªÙˆÙØ±Ø§Ù‹
}
```

### 3. Override Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:

```json
{
  // ... required fields ...
  
  // Override auto-calculated values:
  "base_rent": 9000,         // Override calculated value
  "vat_amount": 1500,       // Override calculated value
  "total_rent": 11000,      // Override calculated value
  
  // Override default settings:
  "status": "pending",       // Override default_contract_status
  "payment_frequency": "quarterly" // Override default_payment_frequency
}
```

---

## ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ù…Ù‚Ø§Ø±Ù†Ø© - Request Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø³ÙŠÙ†

| Ø§Ù„Ø­Ù‚Ù„ | Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø³ÙŠÙ† | Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø³ÙŠÙ† | Ø§Ù„Ø³Ø¨Ø¨ |
|------|------------|-------------|--------|
| `units[]` | âœ… Ù…Ø·Ù„ÙˆØ¨ | âœ… Ù…Ø·Ù„ÙˆØ¨ | Single source of truth |
| `tenant_id` | âœ… Ù…Ø·Ù„ÙˆØ¨ | âœ… Ù…Ø·Ù„ÙˆØ¨ | Ù…Ø·Ù„ÙˆØ¨ |
| `number` | âœ… Ù…Ø·Ù„ÙˆØ¨ | âœ… Ù…Ø·Ù„ÙˆØ¨ | Ù…Ø·Ù„ÙˆØ¨ |
| `start` | âœ… Ù…Ø·Ù„ÙˆØ¨ | âœ… Ù…Ø·Ù„ÙˆØ¨ | Ù…Ø·Ù„ÙˆØ¨ |
| `end` | âœ… Ù…Ø·Ù„ÙˆØ¨ | âœ… Ù…Ø·Ù„ÙˆØ¨ | Ù…Ø·Ù„ÙˆØ¨ |
| `base_rent` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„ |
| `rent_fees` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | Ù‚Ø¯ ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø¯ |
| `vat_amount` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„ |
| `total_rent` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„ |
| `previous_balance` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | Ø®Ø§Øµ Ø¨ÙƒÙ„ Ø¹Ù‚Ø¯ |
| `payment_frequency` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | Ù…Ù† default_payment_frequency |
| `status` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | Ù…Ù† default_contract_status |
| `deposit` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | Ù‚Ø¯ ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø¯ |
| `deposit_status` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | ÙŠÙ…ÙƒÙ† ØªØ¹ÙŠÙŠÙ†Ù‡ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ |
| `ejar_code` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ù…Ø·Ù„ÙˆØ¨ Ø¥Ø°Ø§ ÙƒØ§Ù† require_ejar_code = true | ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ |
| `ejar_pdf` | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | âš ï¸ Ø§Ø®ØªÙŠØ§Ø±ÙŠ | Ø§Ø®ØªÙŠØ§Ø±ÙŠ |

---

## ğŸ¯ Ø§Ù„Ø®Ù„Ø§ØµØ©

### Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Minimum Required):

```json
{
  "units": [{"unit_id": 1, "rent_amount": 5000}],
  "tenant_id": 5,
  "number": "CNT-2025-001",
  "start": "2025-02-01",
  "end": "2026-01-31"
}
```

### Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Auto-calculated):

- âœ… `base_rent` â†’ Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹ `units[].rent_amount` (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„)
- âœ… `vat_amount` â†’ Ù…Ù† `(base_rent + rent_fees) Ã— contract_vat_percentage` (Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„)
- âœ… `total_rent` â†’ Ù…Ù† `base_rent + rent_fees + vat_amount` (+ `previous_balance` Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ù…ÙØ¹Ù‘Ù„)
- âœ… `status` â†’ Ù…Ù† `default_contract_status`
- âœ… `payment_frequency` â†’ Ù…Ù† `default_payment_frequency`

### Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (Optional - Manual Input):

- `rent_fees` - Ù‚Ø¯ ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø¯
- `previous_balance` - Ø®Ø§Øµ Ø¨ÙƒÙ„ Ø¹Ù‚Ø¯
- `deposit` - Ù‚Ø¯ ÙŠØ®ØªÙ„Ù Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù‚Ø¯
- `deposit_status` - ÙŠÙ…ÙƒÙ† ØªØ¹ÙŠÙŠÙ†Ù‡ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
- `ejar_code` - Ù…Ø·Ù„ÙˆØ¨ Ø¥Ø°Ø§ ÙƒØ§Ù† `require_ejar_code = true`
- `ejar_pdf` - Ø§Ø®ØªÙŠØ§Ø±ÙŠ
- `units[].notes` - Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©

---

## ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©

1. **Single Source of Truth**: `units[]` Ù‡Ùˆ Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„ÙˆØ­ÙŠØ¯ Ù„Ù„ÙˆØ­Ø¯Ø§Øª - ÙŠØªÙ… ØªØ®Ø²ÙŠÙ†Ù‡Ø§ ÙÙŠ pivot table `contract_units`
2. **Auto-calculation**: Ù…Ø¹Ø¸Ù… Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙŠÙ…ÙƒÙ† Ø­Ø³Ø§Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ÙØ¹Ù‘Ù„Ø©
3. **Override Support**: ÙŠÙ…ÙƒÙ† ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ ÙÙŠ Request
4. **No Legacy Fields**: ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© `rent` Ùˆ `unit_id` - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù† ÙŠØ³ØªØ®Ø¯Ù… `base_rent` Ùˆ `units[]` ÙÙ‚Ø·
5. **Settings Priority**: Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªØ·Ø¨Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ† ØªØ¬Ø§ÙˆØ²Ù‡Ø§ Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ… ÙŠØ¯ÙˆÙŠØ§Ù‹

---

**ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡**: 2025-01-18  
**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«**: 2025-01-18  
**Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®ÙŠØ±**: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© `rent` Ùˆ `unit_id` - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¢Ù† ÙŠØ³ØªØ®Ø¯Ù… `base_rent` Ùˆ `units[]` ÙÙ‚Ø·

